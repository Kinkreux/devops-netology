# Домашнее задание к занятию "6.1. Типы и структура СУБД"

## Введение

Перед выполнением задания вы можете ознакомиться с 
[дополнительными материалами](https://github.com/netology-code/virt-homeworks/tree/master/additional/README.md).

## Задача 1

Архитектор ПО решил проконсультироваться у вас, какой тип БД 
лучше выбрать для хранения определенных данных.

Он вам предоставил следующие типы сущностей, которые нужно будет хранить в БД:

- **Электронные чеки в json виде** - объектно-ориентированная, например, MongoDB
- **Склады и автомобильные дороги для логистической компании** - графовая. Помню, мы в институте находили кратчайший путь с помощью графов
- **Генеалогические деревья** - графовая. Да, кажется, что логично использовать иерархическую, но в реальности генеалогия может быть более затейливой. Кроме того, графовая - более современная и с ней легче и быстрее работать
- **Кэш идентификаторов клиентов с ограниченным временем жизни для движка аутенфикации** - БД типа "ключ-значение", например, Redis
- **Отношения клиент-покупка для интернет-магазина** - классический вариант - это реляционная БД типа MySQL, до сих пор часто используется. Но это сильно зависит от содержательной стороны вопроса. Скажем, если у нас супермегароскошный товар и его покупатели по миру исчисляются единицами, я бы брала даже Oracle, чтобы поддержать полностью транзакции и чтобы система была супер-надеждной. Если же мы продаем дешевый массмаркет, тогда можно взять БД типа PA/EC или даже PA/EL, которая обеспечит быстродействие, а вопрос с недостачей товара (если мы вовремя не спишем остатки и товара на все оформленные заказы не хватит) можно решить другими путями.

Выберите подходящие типы СУБД для каждой сущности и объясните свой выбор.

## Задача 2

Вы создали распределенное высоконагруженное приложение и хотите классифицировать его согласно 
CAP-теореме. Какой классификации по CAP-теореме соответствует ваша система, если 
(каждый пункт - это отдельная реализация вашей системы и для каждого пункта надо привести классификацию):

- **Данные записываются на все узлы с задержкой до часа (асинхронная запись)** - PA, потому что мы не можем обеспечить consistency. Вдруг запрос придет раньше, чем данные запишутся на этот узел. Можно ли вообще считать системы с асинхронной записью соответствующими consistency-критерию?
- **При сетевых сбоях, система может разделиться на 2 раздельных кластера** - PA, потому что, логически, если система делитс яна 2 кластера, то оба доступны, но неконсистетнты.
- **Система может не прислать корректный ответ или сбросить соединение** - PC, потому что A не достигается.

А согласно PACELC-теореме, как бы вы классифицировали данные реализации?

- **Данные записываются на все узлы с задержкой до часа (асинхронная запись)** - PA/EC. Кажется, Mongo как раз хороший пример
- **При сетевых сбоях, система может разделиться на 2 раздельных кластера** - PA/EL (не могу обосновать, просто consistency точно не гарантируется)
- **Система может не прислать корректный ответ или сбросить соединение** - PC/EC с гарантией консистетности (такое вообще может быть?)) в этой теореме я не разобралась на 100%, хотя лекцию слушала много раз)

## Задача 3

Могут ли в одной системе сочетаться принципы BASE и ACID? Почему?

*Ответ*

Тут я не очень понимаю, что такое "система". Это одна СУБД? Если да, то конечно, можно настроить СУБД так, что она будет в промежуточном состоянии между ACID и BASE. Скажем, в основном ACID, но в некоторых случаях есть послабления. Потому что сама по себе ACID - это очень жесткий императив.

Если система - это комплекс ПО, который используется для какого-то приложения, то - да, конечно. Скажем, самые чувствительные данные, которые нельзя потерять, будут храниться в ACID системах, какие-то незначительные типа кэша или инструменты для быстрого обслуживания огромного числа клиентов - в BASE, а какие-то СУБД могут быть настроены в промежуточном состоянии.

Может быть такое, что из всей ACID важны не все пункты, а 2 или 3. Тогда на них будет упор. В реальности я представляю только отдельные крайние случаи применения чистых ACID и BASE, наверняка чаще они используются с некоторыми отступлениями и допущениями. Или с прокладками в 2-3 слоя СУБД.

## Задача 4

Вам дали задачу написать системное решение, основой которого бы послужили:

- фиксация некоторых значений с временем жизни
- реакция на истечение таймаута

Вы слышали о key-value хранилище, которое имеет механизм [Pub/Sub](https://habr.com/ru/post/278237/). 
Что это за система? Какие минусы выбора данной системы?

*Ответ*

Это Redis. Про pub-sub я почитала, этот подход активно используется в нашей компании, так что я даже понимаю на примере, как работает принцип.

Если кратко, то есть издатель, который издает сообщения, а есть подписчики, которые их получают (push) или считывают сами (pull). Издателей может быть много. Собственно, в микросервисной архитектуре чуть ли не любой сервис может быть как издателем (а может быть издателем и в нескольких топиках), и подписчиком многих других топиков. Это позволяет решить основную задачу, а именно консистентный обмен сообщениями между 3+ системами сразу.

В отличие от других вариантов pub-sub систем, которых много (больше всего сейчас хайпит Apache Kafka), Redis - это в первую очередь хранилище, pub-sub система является только одним из режимов работы. Тут не получится построить сложные системы, разделить сообщения на топики в рамках одного Redis (так же легко, как в той же Kafke, если я правильно понимаю). То есть Redis поддерживает самый простой и прямолинейный способ реализации pub-sub. Он подходит для узконаправленных задач или для систем с небольшим количеством участников / с простой топографией участников. И лектор говорил, что он периодически падает. В случае кэша это не так критично, а в случае pub-sub - достаточно критично, ведь даже если сообщения периодически сбрасываются на диск, снижается производительность (а может, и доступность).